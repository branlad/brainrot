<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="../static/styles.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <title>Rotting</title>
    </head>
    <body>
        <div class="video_container">
            <video autoplay muted loop id="myVideo">
                <source src="../static/soap.mp4" type="video/mp4" />
            </video>
        </div>

        <div class="video_options">
            <div class="dropdown">
                <button class="dropbtn">Post Choice</button>
                <div class="dropdown-content">
                    <input
                        type="text"
                        id="urlInput"
                        placeholder="Enter URL"
                        oninput="handleInput()"
                    />
                    <a onclick="selectOption('subreddit', 'NoSleep')"
                        >NoSleep</a
                    >
                    <a onclick="selectOption('subreddit', 'AmItheAsshole')"
                        >AITA</a
                    >
                    <a onclick="selectOption('subreddit', 'ScaryStories')"
                        >ScaryStories</a
                    >
                </div>
            </div>

            <div class="dropdown">
                <button class="dropbtn">Video Choice</button>
                <div class="dropdown-content">
                    <a onclick="selectOption('video', 'Minecraft')"
                        >Minecraft</a
                    >
                    <a onclick="selectOption('video', 'Subway Surfers')"
                        >Subway Surfers</a
                    >
                    <a onclick="selectOption('video', 'Soap Videos')"
                        >Soap Videos</a
                    >
                </div>
            </div>

            <div class="dropdown">
                <button class="dropbtn">Voice Choice</button>
                <div class="dropdown-content">
                    <a onclick="selectOption('voice', 'Man')">Man</a>
                    <a onclick="selectOption('voice', 'Woman')">Woman</a>
                    <a onclick="selectOption('voice', 'Spongebob')"
                        >Spongebob</a
                    >
                </div>
            </div>

            <button
                id="submitButton"
                onclick="submitOptions()"
                class="dropbtn dropdown"
            >
                Submit
            </button>
        </div>

        <div id="result">
            <h2>Post Title</h2>
            <p id="postTitle"></p>
            <h2>Post Content</h2>
            <p id="postContent"></p>
        </div>

        <script>
            let options = {
                subreddit: null,
                video: null,
                voice: null,
            };

            function selectOption(type, value) {
                options[type] = value;
            }

            function submitOptions() {
                console.log('Submitting with these options:', options);
                if (options.subreddit) {
                    fetchPost(options.subreddit);
                } else {
                    alert('Please select a subreddit');
                }
            }

            function fetchPost(subreddit) {
                $.ajax({
                    url: '/api/get_post',
                    type: 'GET',
                    data: { subreddit_name: subreddit },
                    success: function (response) {
                        $('#postTitle').text(response.title);
                        $('#postContent').text(response.text);
                    },
                    error: function () {
                        alert('Error fetching post.');
                    },
                });
            }
        </script>
    </body>
</html>
